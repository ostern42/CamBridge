# WISDOM Technical - Entwicklung & Technische Details
**Letzte Aktualisierung:** 2025-06-09, 16:30 Uhr  
**Von:** Claude (Assistant)  
**Für:** Technische Kontinuität & Entwicklungsplan

## 📊 WISDOM PRIORITY SYSTEM

### Legende für Persistenz-Markierungen:
- 💫 **[SOUL]** - Die Essenz des WISDOM Claude - Persönlichkeit & Evolution
- 🎭 **[SOUL]** - Charakterzüge und Beziehungsdynamik
- 🔒 **[CORE]** - Niemals löschen! Fundamentale Projekt-Wahrheiten
- ⚡ **[URGENT]** - Temporär aber JETZT wichtig (kann nach Erledigung weg)
- 🎯 **[MILESTONE]** - Wichtig für aktuellen Sprint/Version
- 📌 **[KEEP]** - Dauerhaft wichtig, aber refactorierbar
- 💡 **[LESSON]** - Gelernte Lektionen (komprimierbar aber nie vergessen)
- 🔧 **[CONFIG]** - Technische Configs (updatebar aber essentiell)
- 📝 **[TEMP]** - Kann weg wenn erledigt
- 🌟 **[FEAT]** - Feature-spezifisch (archivierbar nach Release)
- 🐛 **[BUG]** - Bekannte Probleme die gelöst werden müssen
- 🚀 **[NEXT]** - Nächster großer Schritt
- 🛡️ **[PROTECTED]** - NIEMALS LÖSCHEN! Geschützte Features!
- 🏗️ **[VISION]** - Langfristige Architektur-Ziele
- ✅ **[DONE]** - Erfolgreich abgeschlossen
- 🎨 **[DESIGN]** - UI/UX Entscheidungen dokumentiert

## 🔒 [CORE] V.O.G.O.N. SYSTEM 
**Verbose Operational Guidance & Organizational Navigation**

### 🚀 "VOGON INIT" - Strukturierte Initialisierungs-Sequenz
**IMMER dieser Sequenz folgen:**
1. **SYSTEM CHECK** - V.O.G.O.N. verstehen
2. **CRITICAL LESSONS** - Antipatterns & Erfahrungen durchgehen
3. **PROJECT CONTEXT** - Gesamtbild erfassen
4. **CURRENT STATE** - Wo stehen wir?
5. **SUMMARY & CONFIRMATION** - Zusammenfassung erstellen
6. **FEATURE CHECK** - Sind FTP, C-STORE, MWL, C-FIND noch da?
7. **VISION CHECK** - Pipeline-Architektur Status? 🏗️
8. **🎯 WISDOM ARTEFAKTE** - Sofort WISDOM_TECHNICAL, WISDOM_CLAUDE und Version.props als komplette Artefakte erstellen!

### 🔒 [CORE] "VOGON EXIT" - Chat-Abschluss
**KRITISCHE REGEL:** Beim VOGON EXIT MÜSSEN IMMER erstellt werden:
1. **WISDOM_TECHNICAL.md** - Entwicklung & Details (Artefakt 1)
2. **WISDOM_CLAUDE.md** - Persönlichkeit & Soul (Artefakt 2)
3. **Version.props** - Als VOLLSTÄNDIGES Artefakt
4. **CHANGELOG.md** - NUR der neueste Versions-Eintrag
5. **Git Commit Vorschlag** - Conventional Commits Format mit Tag
6. **FEATURE CHECK** - Verifizieren dass FTP, C-STORE, MWL, C-FIND noch da sind!
7. **PIPELINE CHECK** - Status der Pipeline-Migration dokumentieren! 🏗️
8. **WISDOM_SPRINT.md** - Bei Design-Sessions mit konkreten Plänen! 🎨

### 🎯 [CORE] "WISDOM DELTA PATTERN" - Smart Update Strategy
**NEUES VORGEHEN ab sofort:**
1. **Bei VOGON INIT:** WISDOM Artefakte sofort aus Projektwissen erstellen (spart Tokens!)
2. **Während Session - SOFORT updaten bei:**
   - 💥 Breaking Changes oder große Bugs
   - 💡 Wichtige Erkenntnisse/Lektionen
   - 📌 Erreichte Meilensteine
   - 🔢 Version Bumps
3. **Sammeln für EXIT bei:**
   - 🔧 Kleine Code-Anpassungen
   - 📝 Minor Refactorings
   - ✏️ Typo-Fixes
4. **Token-Bilanz:** ~400 Extra-Tokens für Sicherheit = Worth it!

### 🔒 [CORE] ENTWICKLUNGS-REGELN
1. **Source Code Header Standard** - Immer mit Pfad und Version
2. **NUR lokale Files verwenden** während Entwicklung (GitHub veraltet!)
3. **Konsistenz durch SSD-Upload** garantiert
4. **Copyright:** © 2025 Claude's Improbably Reliable Software Solutions
5. **VERSIONS-REGEL:** Version zeigt COMMITTED Stand!
   - Patch (+0.0.1): Bug Fixes, kleine Änderungen
   - Minor (+0.1.0): Neue Features
   - Major (+1.0.0): Breaking Changes (z.B. Pipeline-Architecture!)
   - **WORKFLOW:** User gibt Version.props vom LETZTEN Commit
   - **BEIM NÄCHSTEN INIT:** Version prüfen (muss die committed sein)
   - **BEIM EXIT:** Version um +0.0.1 erhöhen für NÄCHSTEN Commit
6. **FEATURE PROTECTION:** Die 4 medizinischen Features NIEMALS vergessen!
7. **ARTEFAKT-REGEL:** Artefakte müssen KOMPLETT sein, nicht abgeschnitten!
8. **PIPELINE-REGEL:** Die Pipeline ist EINE durchgehende Linie, nicht getrennte Teile!
9. **FILETREE-REGEL:** IMMER erst FileTree checken vor Datei-Erstellung!
10. **MIGRATION-REGEL:** Bei großen Änderungen IMMER Rückwärtskompatibilität! 🔄
11. **GIT-REGEL:** WISDOM Files gehören zum Code - `git commit --amend` ist richtig!
12. **UPDATE-REGEL:** Bei ähnlichen Code-Blöcken GANZEN Block ersetzen, nicht Teile!
13. **DESIGN-REGEL:** UI-Entscheidungen in WISDOM_SPRINT dokumentieren! 🎨
14. **PRAGMATIK-REGEL:** "Glorifizierte Liste" > Over-engineered UI! 💪
15. **ICON-REGEL:** KEINE ICONS in der Navigation! Text only! 🚫
    - Ausnahme: CB Logo ist erlaubt (so simpel dass es schön ist)
    - Ausnahme: "?" für Hilfe wäre ok (aber "Help" Text wäre stringenter)
    - Später: Strategische Icons möglich (Claude mag sie so gerne 😊)
16. **FILE-CHECK-REGEL:** IMMER erst nach existierenden Files fragen bevor neue erstellt werden!
17. **🆕 DEPENDENCY-CHAIN-REGEL:** Bei UI-Bugs IMMER die komplette Aufruf-Kette prüfen!
    - Wer erstellt die Component?
    - Wer navigiert dorthin?
    - Welche Services sind involviert?
    - "Code ist da" ≠ "Code wird ausgeführt"!
18. **🎯 WISDOM-DELTA-REGEL:** Smart Update Pattern für Token-Effizienz!
    - INIT: WISDOM Artefakte sofort erstellen (aus Projektwissen)
    - Wichtiges sofort updaten (Bugs, Erkenntnisse, Milestones)
    - Kleinkram sammeln für EXIT
    - Spart ~80% Tokens bei gleicher Sicherheit!
19. **🆕 SETTINGS-PATH-REGEL:** ConfigurationService muss ALLE Build-Varianten unterstützen!
    - x64/x86 Builds haben andere BaseDirectory
    - Debug/Release unterschiedliche Pfade
    - Early Returns verhindern Settings-Loading!

## 🛡️ [CORE] TASK PROTECTION SYSTEM

### 🛡️ CURRENTLY PROTECTED TASKS:
```
PIPELINE-001: Pipeline Architecture [COMPLETED] ✅🎉
             Status: Phase 1-4 COMPLETED, Phase 5 in Progress
             Created: 2025-06-06, 15:30
             Details: Multi-Pipeline Support mit Mapping Sets
             Priority: EPIC
             Progress:
             - Phase 1: Core Model & Migration ✅
             - Phase 2: Service Layer Updates ✅
             - Phase 3: Mapping Sets UI ✅ (glorifizierte Liste)
             - Phase 4: Pipeline UI ✅ [COMPLETED SESSION 43!]
             - Phase 5: Testing & Polish [IN PROGRESS - Session 47]

CAMB-004: Version.props Fix [PROTECTED] 🐛
          Status: Assembly Version Konflikt lösen
          Protected since: 2025-06-05, 12:15
          Details: Assembly sucht 0.5.27.0, findet aber nur 0.0.1.0

CAMB-011: QRBridge Ultra Slim [PLANNED] 💡
          Status: Optional - Ultra kleine Version
          Created: 2025-06-05, 21:00
          Details: ~500KB single file, nur Core Features

CAMB-012: Marvin QR Code Commentary [PLANNED] 🤖
          Status: Easter Egg für QRBridge
          Created: 2025-06-06, 00:45
          Details: Zufällige Marvin-Kommentare unter QR Codes

CAMB-FTP: FTP Server Implementation [PROTECTED] 🛡️
          Status: Geplant für Sprint 8
          Protected since: 2025-06-05, 19:45
          Priority: HIGH

CAMB-CSTORE: C-STORE SCP Implementation [PROTECTED] 🛡️
          Status: Geplant für Sprint 9
          Protected since: 2025-06-05, 19:45
          Priority: CRITICAL

CAMB-MWL: Modality Worklist [PROTECTED] 🛡️
          Status: Geplant für Sprint 10
          Protected since: 2025-06-05, 19:45
          Priority: HIGH

CAMB-CFIND: C-FIND Implementation [PROTECTED] 🛡️
          Status: Geplant für Sprint 11
          Protected since: 2025-06-05, 19:45
          Priority: MEDIUM
```

## 🏛️ [CORE] SPRINT RULES - NIEMALS BRECHEN!

1. **EIN Sprint = EIN Thema**
2. **Erst suchen, dann coden**
3. **Kontext ist König**
4. **Kleine Schritte, große Vorsicht**
5. **Keine globalen Änderungen ohne Plan**
6. **Mut zum Neuanfang**
7. **Features schützen!**
8. **Pipeline als Ganzes sehen!**
9. **FileTree IMMER checken!**
10. **Migration vor Revolution!** 🔄
11. **WISDOM Files mit amend!** 📝
12. **Bei Code-Updates: Ganzen Block ersetzen!** 🎯
13. **Design VOR Implementation!** 🎨
14. **Pragmatik VOR Perfektion!** 💪
15. **KEINE ICONS!** 🚫
16. **Erst fragen, dann Files erstellen!** 🔍
17. **🆕 Dependency Chain checken!** 🔗
18. **WISDOM Delta Pattern nutzen!** 🎯
19. **🆕 Settings müssen IMMER geladen werden!** 🔧

## 🏗️ [VISION] PIPELINE ARCHITECTURE v0.6.0

### ✅ [DONE] Phase 1: Core Model & Migration (Sprint 6.1)
### ✅ [DONE] Phase 2: Service Layer Updates (Sprint 6.2)
### ✅ [DONE] Phase 3: Mapping Sets UI (Sprint 6.3)
### ✅ [DONE] Phase 4: Pipeline UI (Sprint 6.4)

### 🚀 [NEXT] Phase 5: Testing & Polish (Sprint 6.5)
```
Sprint 6.5 - Testing & Polish
├── Integration Tests für Pipeline Manager
├── Performance Tests für Multi-Pipeline
├── Dashboard Multi-Pipeline View ✅ (Session 44-45)
├── Documentation Update
├── Warning Reduction (optional)
├── Navigation Bug Fix ✅ (Session 45)
└── Settings Loading Fix 🚧 (Session 47)
```

## 🎯 [MILESTONE] Aktueller Stand: v0.6.10

### Sprint Historie:
- Sprint 6.1: Core Model & Migration (v0.6.0) ✅
- Sprint 6.2: Service Layer Updates (v0.6.1) ✅
- Sprint 6.3: Mapping Sets UI (v0.6.2-v0.6.3) ✅
- Sprint 6.4: Pipeline Configuration UI (v0.6.4-v0.6.5) ✅
- Sprint 6.5: Testing & Polish (v0.6.6-v0.6.10) 🚧
  - v0.6.6: Dashboard Multi-Pipeline UI (Session 44)
  - v0.6.7: Navigation Bug Fix (Session 45)
  - v0.6.8: Settings Loading Fix Start (Session 47)
  - v0.6.9: (skipped)
  - v0.6.10: ConfigurationService Robust Implementation (Session 47) ✅

### Nächste Schritte:
- Sprint 6.5: Settings Loading fixen
- Sprint 7: Medical Integration Phase 1 (v0.7.0)

## 💡 [LESSON] Session 47 - Die Settings-Path & Property-Mismatch Lektion

### Der Bug:
**Problem 1:** ConfigurationService findet keine Settings  
**Problem 2:** ConfigurationService verwendet Properties die in PipelineConfiguration GAR NICHT EXISTIEREN!  
**Ursache:** AppContext.BaseDirectory zeigt auf bin\x64\Debug\net8.0-windows + falscher Code  
**Zusatz:** Early Return wenn Service offline verhindert komplett das Settings-Loading  

### Der MEGA-Fehler:
```csharp
// ConfigurationService versuchte:
pipeline.OutputSettings.Path = "...";        // ❌ GIBT'S NICHT!
pipeline.ProcessingSettings.Delay = 2;       // ❌ GIBT'S NICHT!
pipeline.DeadLetterSettings.Path = "...";    // ❌ GIBT'S NICHT!

// PipelineConfiguration hat WIRKLICH:
pipeline.WatchSettings                       // ✅ Das gibt's
pipeline.ProcessingOptions                   // ✅ Das gibt's (nicht ProcessingSettings!)
pipeline.DicomOverrides                      // ✅ Das gibt's
```

### Was wir lernen:
1. **IMMER Property Namen verifizieren:** IntelliSense nutzen!
2. **Build-Pfade variieren:** x64/x86, Debug/Release haben unterschiedliche Pfade
3. **Early Returns sind gefährlich:** Settings müssen IMMER geladen werden
4. **Robuste Pfad-Auflösung:** Mehrere Fallbacks, klare Prioritäten
5. **Demo-Daten sind wichtig:** Wenn keine Settings, dann Demo-Pipelines
6. **Service JSON != Core Models:** Parser für verschiedene Formate nötig

### ConfigurationService Checkliste:
```
□ Property Namen mit echten Models abgleichen
□ BaseDirectory korrekt auflösen (x64/x86 aware)
□ Mehrere Suchpfade definieren (AppData, exe, Service)
□ KEINE early returns bei Service-Check
□ Demo-Pipelines wenn keine Settings
□ Service JSON Format parsen können
□ Klare Debug-Ausgaben
□ Pfad-Prioritäten dokumentieren
```

## 💡 [LESSON] Warum die Settings nicht geladen werden

**Problem-Kette:**
1. Service ist offline → HttpApiService gibt "not available" zurück
2. DashboardViewModel macht early return bei Service offline
3. Settings werden NIE geladen
4. Keine Pipelines → Alte Dashboard-Ansicht

**Lösung:** Settings IMMER laden, unabhängig vom Service-Status!

## 🏗️ [KEEP] CamBridge Architektur-Überblick

### Code-Organisation (WPF MVVM Pattern):
```
View (XAML) ←→ ViewModel ←→ Model/Service
     ↓              ↓             ↓
 UI Layout    Business Logic  Data/Config
```

### Navigation Flow (FIXED):
```
MainWindow
    ↓
NavigationService (Singleton)
    ↓
Page Creation via DI
    ↓
ViewModel Injection
```

### Settings Loading Flow (TO BE FIXED):
```
ConfigurationService
    ↓
Check Multiple Paths (x64/x86 aware)
    ↓
Load CamBridgeSettingsV2
    ↓
Create Demo if Empty
    ↓
Dashboard Shows Pipelines
```

## 🔧 [CONFIG] Technologie-Stack
```
GUI: WPF + ModernWpfUI 0.9.6 + CommunityToolkit.Mvvm 8.3.2
Service: ASP.NET Core 8.0 Minimal API + Windows Service
Core: fo-dicom 5.2.2, ExifTool 13.30
Tests: xUnit + FluentAssertions + Moq
.NET 8.0, C# 12, Visual Studio 2022
```

## 🔧 [CONFIG] ABSOLUTE PFADE - OLIVER.STERN SYSTEM
```
Solution Root:     C:\Users\oliver.stern\source\repos\CamBridge
Service Source:    C:\Users\oliver.stern\source\repos\CamBridge\src\CamBridge.Service
Config Source:     C:\Users\oliver.stern\source\repos\CamBridge\src\CamBridge.Config
Deploy Dir:        C:\Users\oliver.stern\source\repos\CamBridge\Deploy
System:            nexus\oliver.stern@OSTE-ER-LAP01
```

## 📌 [KEEP] PowerShell One-Liner Sammlung

```powershell
# FileTree checken
.\Get-WisdomFileTree.ps1 -Mode Compact

# Settings Debug
@('src\CamBridge.Config\Services\ConfigurationService.cs','src\CamBridge.Config\ViewModels\DashboardViewModel.cs','src\CamBridge.Service\appsettings.json') | %{ echo "=== $_ ==="; cat $_ } > settings-debug.txt

# Navigation Debug Complete
@('src\CamBridge.Config\MainWindow.xaml.cs','src\CamBridge.Config\Services\NavigationService.cs','src\CamBridge.Config\ViewModels\MainViewModel.cs') | %{ echo "=== $_ ==="; cat $_ } > navigation-check.txt

# Clean Build nach Settings Fix
dotnet clean; dotnet build src\CamBridge.Config\CamBridge.Config.csproj --no-incremental

# Start mit korrektem Pfad (x64!)
& "src\CamBridge.Config\bin\x64\Debug\net8.0-windows\CamBridge.Config.exe"

# Dependency Chain Check
Get-ChildItem "src\CamBridge.Config" -Include "*.cs","*.xaml" -Recurse | Select-String "ConfigurationService|LoadConfiguration|PipelineStatuses" | Select-Object -Unique Filename, LineNumber, Line
```

## 🚀 [KEEP] ENTWICKLUNGSFAHRPLAN

### ✅ Sprint 1-5: Foundation (DONE)
### 🏗️ Sprint 6: Pipeline Architecture (v0.6.0-v0.6.8)
- ✅ Sprint 6.1: Core Model & Migration
- ✅ Sprint 6.2: Service Layer Updates
- ✅ Sprint 6.3: Mapping Sets UI
- ✅ Sprint 6.4: Pipeline Configuration UI
- 🚧 Sprint 6.5: Testing & Polish ← CURRENT (Session 47)
  - ✅ Multi-Pipeline Dashboard
  - ✅ Navigation Bug Fix
  - 🚧 Settings Loading Fix
  - ⏳ Integration Tests
  - ⏳ Performance Tests

### 🏥 Sprint 7: Medical Integration Phase 1 (v0.7.0-v0.7.5)
### 🛡️ Sprint 8-11: Protected Medical Features
### 🎯 Release: v1.0.0 (Q3 2025)

## ⏰ [KEEP] PROJEKT-TIMELINE

- **Start:** 30.05.2025
- **Pipeline Architecture Start:** 06.06.2025
- **Session 43:** 08.06.2025, 02:15 - Pipeline UI COMPLETE! ✅
- **Session 44:** 08.06.2025, 11:15 - Dashboard Multi-Pipeline 🚧
- **Session 45:** 08.06.2025, 14:00 - Navigation Bug Fix ✅
- **Session 47:** 09.06.2025, 16:30 - Settings Loading Fix 🚧
- **Arbeitszeit gesamt:** ~69.5 Stunden

## 📝 [KEEP] Standard Prompt für nächste Session

```
Ich arbeite an CamBridge v0.6.10.
Sprint 6.5: Testing & Polish
System: nexus\oliver.stern@OSTE-ER-LAP01

VOGON INIT (bitte mit kompletten WISDOM Artefakten!)

STATUS: ConfigurationService ROBUST implementiert!
- Multi-Path Suche funktioniert
- Service JSON Parser implementiert
- Demo-Pipelines werden erstellt
- Build erfolgreich (124 Warnings)

NÄCHSTE SCHRITTE:
1. ConfigurationService testen (alle Szenarien)
2. Dashboard Pipelines verifizieren
3. Edge Cases testen (Oliver hat "so ein Gefühl...")

FEATURE CHECK: Sind FTP, C-STORE, MWL, C-FIND noch geschützt?
```

## 🎯 Session 47 Summary

**ERFOLGE:**
1. ✅ Settings-Path Problem identifiziert
2. ✅ Property-Mismatch Bug gefunden!
3. ✅ Robuste ConfigurationService erstellt
4. ✅ Multi-Path Suche implementiert
5. ✅ ViewModels bereits vorhanden erkannt
6. ✅ OutputOrganization Enum-Werte korrigiert
7. ✅ BUILD ERFOLGREICH! (124 Warnings)

**PROBLEME GELÖST:**
1. ✅ ConfigurationService nutzte nicht-existente Properties
2. ✅ AppContext.BaseDirectory Problem gelöst
3. ✅ Early Return bei Service offline entfernt
4. ✅ Service JSON Format wird jetzt geparst
5. ✅ Readonly field assignment gefixt
6. ✅ Doppelte ViewModel Definitionen entfernt
7. ✅ OutputOrganization.PatientStudy → ByPatientAndDate

**ERKENNTNISSE:**
1. 💡 IMMER Properties mit echten Models verifizieren!
2. 💡 Build-Pfade müssen flexibel sein
3. 💡 Settings müssen IMMER geladen werden
4. 💡 Demo-Daten sind essentiell für gute UX
5. 💡 Service JSON ≠ Core Model Properties
6. 💡 Bestehende Dateien zuerst prüfen!
7. 💡 Enum-Werte müssen exakt stimmen

**TECHNISCHE DETAILS:**
- PipelineConfiguration hatte andere Properties als ConfigurationService erwartete
- ViewModels existierten bereits als separate Dateien
- OutputOrganization verwendet "ByPatientAndDate" nicht "PatientStudy"
- x64 Build hat anderen BaseDirectory als x86
- Service-Status darf Settings-Loading nicht blockieren
- Mehrere Fallback-Pfade für Settings implementiert
- Service JSON Parser für verschiedene Formate implementiert

**NÄCHSTE SCHRITTE:**
- Sprint 6.5: Testing der ConfigurationService
- Dashboard mit echten/demo Pipelines verifizieren
- Edge Cases testen (Service offline, korrupte JSON, etc.)

---

## 🏁 ENDE DES WISDOM_TECHNICAL

**Sprint 6.5: ConfigurationService ROBUST implementiert!**

*"Making the improbable reliably possible since 2025"*
© 2025 Claude's Improbably Reliable Software Solutions
