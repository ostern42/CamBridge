<!-- src\CamBridge.Config\Views\LogViewerPage.xaml -->
<!-- Version: 0.8.11 - MINIMAL WORKING VERSION -->
<!-- Description: Nur flache Log-Anzeige, keine fancy TreeView -->
<!-- Copyright: © 2025 Claude's Improbably Reliable Software Solutions -->

<Page x:Class="CamBridge.Config.Views.LogViewerPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:CamBridge.Config.Views"
      xmlns:viewmodels="clr-namespace:CamBridge.Config.ViewModels"
      xmlns:converters="clr-namespace:CamBridge.Config.Converters"
      mc:Ignorable="d" 
      d:DesignHeight="600" d:DesignWidth="1000"
      d:DataContext="{d:DesignInstance Type=viewmodels:LogViewerViewModel}"
      Title="Log Viewer">

    <Page.Resources>
        <!-- Nur die WIRKLICH benötigten Converter -->
        <converters:BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBoolToVisibility"/>
    </Page.Resources>

    <DockPanel>
        <!-- SIMPLE Header -->
        <Border DockPanel.Dock="Top" Padding="8" Background="White"
                BorderBrush="#E0E0E0" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Title Row -->
                <DockPanel Grid.Row="0">
                    <TextBlock Text="Log Viewer" FontSize="16" FontWeight="Bold" DockPanel.Dock="Left"/>

                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" 
                                HorizontalAlignment="Right">
                        <TextBlock Text="Lines: " Opacity="0.7"/>
                        <TextBlock Text="{Binding DisplayedLineCount}" FontWeight="Bold"/>
                        <TextBlock Text=" / " Opacity="0.5"/>
                        <TextBlock Text="{Binding TotalLineCount}" Opacity="0.7"/>
                    </StackPanel>
                </DockPanel>

                <!-- Pipeline Selection Row -->
                <DockPanel Grid.Row="1" Margin="0,4,0,0">
                    <ComboBox ItemsSource="{Binding PipelineSelections}"
                              MinWidth="200" MaxWidth="300" Height="24">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding IsSelected}" 
                                          Content="{Binding Name}"
                                          Margin="0" Padding="2,0"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                        <ComboBox.Text>
                            <Binding Path="CurrentLogFiles" Mode="OneWay"/>
                        </ComboBox.Text>
                    </ComboBox>

                    <!-- Action buttons -->
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" 
                                HorizontalAlignment="Right">
                        <Button Content="Refresh" Command="{Binding RefreshCommand}" 
                                Margin="2,0" Padding="8,2"/>
                        <Button Content="Clear" Command="{Binding ClearLogCommand}" 
                                Margin="2,0" Padding="8,2"/>
                        <Button Content="Export" Command="{Binding ExportLogCommand}" 
                                Margin="2,0" Padding="8,2"/>
                        <Button Content="Open Folder" Command="{Binding OpenLogFolderCommand}" 
                                Margin="2,0" Padding="8,2"/>
                    </StackPanel>
                </DockPanel>

                <!-- Filter Row -->
                <DockPanel Grid.Row="2" Margin="0,4,0,0">
                    <!-- Simple search -->
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,4,0"/>
                        <TextBox Width="200" Height="22"
                                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                    </StackPanel>

                    <!-- Level filters -->
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" 
                                HorizontalAlignment="Right">
                        <CheckBox IsChecked="{Binding ShowDebug}" Content="Debug" Margin="4,0"/>
                        <CheckBox IsChecked="{Binding ShowInformation}" Content="Info" Margin="4,0"/>
                        <CheckBox IsChecked="{Binding ShowWarning}" Content="Warning" Margin="4,0"/>
                        <CheckBox IsChecked="{Binding ShowError}" Content="Error" Margin="4,0"/>
                        <CheckBox IsChecked="{Binding ShowCritical}" Content="Critical" Margin="4,0"/>
                    </StackPanel>
                </DockPanel>
            </Grid>
        </Border>

        <!-- Loading indicator -->
        <ProgressBar DockPanel.Dock="Top" IsIndeterminate="True" Height="2"
                     Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"/>

        <!-- SIMPLE DataGrid - keine TreeView! -->
        <DataGrid ItemsSource="{Binding FilteredCombinedEntries}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  IsReadOnly="True"
                  SelectionMode="Extended"
                  SelectionUnit="FullRow"
                  CanUserSortColumns="True"
                  ClipboardCopyMode="IncludeHeader"
                  FontFamily="Consolas"
                  FontSize="11">

            <!-- Context Menu für Copy/Export -->
            <DataGrid.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Copy" InputGestureText="Ctrl+C" 
                              Command="{Binding CopySelectedCommand}"/>
                    <MenuItem Header="Copy All" 
                              Command="{Binding CopySelectedCommand}"/>
                    <Separator/>
                    <MenuItem Header="Export..." 
                              Command="{Binding ExportLogCommand}"/>
                </ContextMenu>
            </DataGrid.ContextMenu>

            <DataGrid.Columns>
                <DataGridTextColumn Header="Time" 
                                    Binding="{Binding Timestamp, StringFormat='HH:mm:ss.fff'}" 
                                    Width="90"/>
                <DataGridTextColumn Header="Level" 
                                    Binding="{Binding LevelText}" 
                                    Width="50"/>
                <DataGridTextColumn Header="Pipeline" 
                                    Binding="{Binding Pipeline}" 
                                    Width="120"/>
                <DataGridTextColumn Header="Stage" 
                                    Binding="{Binding Stage}" 
                                    Width="120"/>
                <DataGridTextColumn Header="Message" 
                                    Binding="{Binding Message}" 
                                    Width="*"/>
            </DataGrid.Columns>

            <!-- Row style for level colors -->
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding LevelText}" Value="ERR">
                            <Setter Property="Foreground" Value="#D32F2F"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding LevelText}" Value="WRN">
                            <Setter Property="Foreground" Value="#F57C00"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding LevelText}" Value="DBG">
                            <Setter Property="Foreground" Value="#616161"/>
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.RowStyle>
        </DataGrid>
    </DockPanel>
</Page>
