<!-- src\CamBridge.Config\Views\DashboardPage.xaml -->
<!-- Version: 0.7.23 - MINIMAL Dashboard with Error Count -->
<Page x:Class="CamBridge.Config.Views.DashboardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="http://schemas.modernwpf.com/2019"
      Title="Dashboard">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Title -->
        <StackPanel Grid.Row="0">
            <TextBlock Text="Dashboard" Style="{StaticResource TitleTextBlockStyle}"/>
            <Button Content="Refresh" 
                    Command="{Binding RefreshCommand}"
                    HorizontalAlignment="Right"
                    Margin="0,-30,0,0"/>
        </StackPanel>

        <!-- Service Status Card - SIMPLE! -->
        <Border Grid.Row="1" 
                Margin="0,20,0,20"
                Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                BorderThickness="2"
                CornerRadius="4"
                Padding="20">
            <Border.BorderBrush>
                <Binding Path="ServiceStatus" Converter="{StaticResource ServiceStatusToColorConverter}"/>
            </Border.BorderBrush>

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status Icon -->
                <Ellipse Grid.Column="0"
                         Width="20" Height="20"
                         Margin="0,0,15,0">
                    <Ellipse.Fill>
                        <Binding Path="ServiceStatus" Converter="{StaticResource ServiceStatusToColorConverter}"/>
                    </Ellipse.Fill>
                </Ellipse>

                <!-- Status Text -->
                <StackPanel Grid.Column="1">
                    <TextBlock Text="{Binding ServiceStatus, StringFormat='Service: {0}'}" 
                               FontSize="18" 
                               FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding UptimeText}" 
                               Opacity="0.7"/>
                    <TextBlock Text="{Binding VersionText}" 
                               Opacity="0.7"/>
                    <TextBlock Text="{Binding LastUpdate, StringFormat='Last update: {0:HH:mm:ss}'}" 
                               FontSize="11" 
                               Opacity="0.5"/>
                </StackPanel>

                <!-- Start Button -->
                <Button Grid.Column="2"
                        Content="Start Service"
                        Command="{Binding StartServiceCommand}"
                        Visibility="{Binding IsServiceRunning, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
            </Grid>
        </Border>

        <!-- Pipeline List - SIMPLE! -->
        <GroupBox Grid.Row="2" Header="Pipelines">
            <ItemsControl ItemsSource="{Binding PipelineStatuses}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                                Margin="0,5"
                                Padding="15"
                                CornerRadius="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Status Indicator -->
                                <Ellipse Grid.Column="0"
                                         Width="12" Height="12"
                                         Margin="0,0,10,0">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="Gray"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsEnabled}" Value="True">
                                                    <Setter Property="Fill" Value="Green"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>

                                <!-- Pipeline Info -->
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="{Binding PipelineName}" 
                                               FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding WatchFolder}" 
                                               FontSize="12" 
                                               Opacity="0.7"/>
                                </StackPanel>

                                <!-- Stats -->
                                <StackPanel Grid.Column="2" 
                                            Orientation="Horizontal"
                                            VerticalAlignment="Center">
                                    <TextBlock Text="{Binding ProcessedToday, StringFormat='Processed: {0}'}" 
                                               Margin="0,0,15,0"/>
                                    <TextBlock Text="{Binding QueueLength, StringFormat='Queue: {0}'}" 
                                               Margin="0,0,15,0"/>
                                    <!-- Error Count - nur wenn > 0 -->
                                    <TextBlock Text="{Binding ErrorsToday, StringFormat='Errors: {0}'}" 
                                               Foreground="OrangeRed"
                                               FontWeight="SemiBold"
                                               Visibility="{Binding ErrorsToday, Converter={StaticResource GreaterThanZeroConverter}}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </GroupBox>

        <!-- Loading Overlay -->
        <ui:ProgressBar Grid.Row="0" Grid.RowSpan="3"
                        IsIndeterminate="True"
                        Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                        VerticalAlignment="Top"/>
    </Grid>
</Page>
